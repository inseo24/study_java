### 프로세스와 쓰레드

프로세스 : 실행 중인 프로그램, OS에서 필요한 자원(메모리)을 할당받음, 자원과 쓰레드로 구성

쓰레드 : 실제 작업을 수행하는 것

모든 프로세스에는 하나 이상의 쓰레드가 존재하고, 둘 이상의 쓰레드를 가진 프로세스를 멀티 쓰레드 프로세스라고 한다.

쓰레드는 개별적인 call stack이 필요하므로 프로세스 메모리 한계에 따라 생성할 수 있는 쓰레드 수가 정해진다.

### 멀티 태스킹과 멀티쓰레딩

대부분의 OS는 멀티태스킹을 지원해 여러 개의 프로세스가 동시에 실행될 수 있다.

멀티쓰레딩은 하나의 프로세스 내에서 여러 쓰레드가 동시에 작업을 수행하는 것이다.

멀티쓰레딩의 장점

- CPU 사용률 향상
- 자원 효율적 사용
- 응답성 향상
- 작업이 분리되어 코드 간결해짐

단, 단점으로 동기화(synchronization), 교착상태(deadlock)와 같은 문제를 고려해야 한다.

### 쓰레드 구현과 실행

구현 방법

1. Thread 클래스 상속
2. Runnable 인터페이스 구현 → 이게 일반적(Thread 상속시 다른 클래스 상속이 안됨으로)

```java
class MyThread extends Thraed {
	public void run() {...}
}
```

```java
class MyThread implements Runnable {
	public void run() {...}
}
```

Runnable을 구현하면 Thread 클래스의 static 메서드인 currentThread()를 호출해 쓰레드에 대한 참조를 얻어야만 호출이 가능하다. 

참고로 쓰레드 이름은 생성자나 메서드를 통해 지정, 변경이 가능하다. 

지정하지 않으면 “Thread-번호”의 형식으로 이름이 정해진다.

### Thread의 실행 - start()

start()를 호출되면 실행 대기 상태에 있다가 자기 차례가 되면 실행된다.

한 번 실행이 종료된 쓰레드는 다시 실행할 수 없다. 

run()을 호출하는 것은 단순히 클래스에 선언된 메서드를 호출하는 것이지 쓰레드를 실행시키는 것이 아니다.

반변 start()는 쓰레드 작업 실행에 필요한 call stack을 생성한 다음, run()을 호출해 생성된 call stack에 run()이 첫번째로 올라가게 한다.

1. main메서드에서 쓰레드의 start()를 호출한다.
2. start()는 새로운 쓰레드를 생성하고, 쓰레드가 작업하는데 사용될 call stack을 생성한다.
3. 새로 생성된 call stack에 run()이 호출되어, 쓰레드가 독립적 공간에서 작업을 수행한다.
4. call stack이 2개 이상이 되면, 스케줄러가 정한 순서에 의해 번갈아 가며 실행된다.

스케줄러는 실행대기중인 쓰레드들의 우선순위를 고려해 실행순서와 실행시간을 결정하고, 각 쓰레드들은 작성된 스케줄에 따라 자신의 순서가 되면 지정된 시간동안 작업을 수행한다.

실행 중인 사용자 쓰레드가 하나도 없을 때 프로그램은 종료된다.

### 싱글쓰레드와 멀티쓰레드

멀티쓰레드가 싱글보다 시간이 더 걸리는 경우가 있는데, 

1. thread간 context switching 시간이 걸리고,
2. 대기시간 때문이다. (같은 자원을 두고 경쟁하면서 발생하는)

실행중인 프로세스는 OS의 프로세스 스케줄러의 영향을 받는다.

JVM의 쓰레드 스케줄러에 의해 어떤 쓰레드가 얼마동안 실행될 것인지 결정되는 것과 같이, 프로세스도 프로세스 스케줄러에 의해 실행순서와 실행시간이 결정된다.

자바가 OS에 독립적이라고 하나 일부 OS 종속적인 부분이 몇 가지 있는데 그 중 하나가 쓰레드다.

서로 다른 자원을 사용하는 작업의 경우 멀티 쓰레드가 더 효율적이다. 

### 쓰레드의 우선순위

쓰레드는 우선순위라는 속성을 갖고 있어 이를 이용해 특정 쓰레드가 더 많은 작업시간을 갖도록 할 수 있다.

```java
void setPriority(int newPriority)
int getPriority()

public static final int MAX_PRIORITY = 10
public static final int MIN_PRIORITY = 1
public static final int NORM_PRIORITY = 5
```

우선순위의 범위는 1~10이며 숫자가 높을수록 우선순위가 높다.

쓰레드를 실행하기 전에만 우선순위를 변경할 수 있다.

### 쓰레드 그룹(thread group)

서로 관련된 쓰레드를 그룹으로 다루기 위한 것으로, 자신이 속한 쓰레드 그룹이나 하위 쓰레드 그룹은 변경할 수 있지만, 다른 쓰레드 그룹이 쓰레드를 변경할 수는 없다.

모든 쓰레드는 반드시 쓰레드 그룹에 포함되어 있어야 하기 때문에 쓰레드 그룹을 지정하는 생성자를 사용하지 않고 생성된 쓰레드는 기본적으로 자신을 생성한 쓰레드와 같은 그룹에 속하게 된다.

### 데몬 쓰레드

다른 일반 쓰레드의 작업을 돕는 보조적인 역할을 수행하는 쓰레드

예를 들어, 가비지 컬렉터, 화면자동갱신 등이 있다.

무한루프와 조건문을 이용해 실행 후 대기하고 있다가 특정 조건이 만족되면 작업을 수행하고 다시 대기하도록 작성한다. 

데몬 쓰레드가 생성한 쓰레드는 자동적으로 데몬 쓰레드가 된다.

```java
boolean isDaemon() // 쓰레드가 데몬쓰레드인지 확인
void setDeamon(boolean on) // 쓰레드를 데몬쓰레드로 또는 사용자 쓰레드로 변경
```

프로그램을 실행하면 JVM은 가비지컬렉션, 이벤트처리, 그래픽 처리와 같이 프로그램이 실행되는데 필요한 보조작업을 수행하는 데몬쓰레드들을 자동적으로 생성해 실행시킨다. 

이들은 system쓰레드 그룹 또는 main쓰레드 그룹에 속한다.

### 쓰레드 실행제어

### 쓰레드의 동기화